{"version":3,"sources":["webpack://_JUPYTERLAB.CORE_OUTPUT/../../packages/pyolite-kernel-extension/lib/index.js","webpack://_JUPYTERLAB.CORE_OUTPUT/../../packages/pyolite-kernel/lib/kernel.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AAC2D;AACR;AACS;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,6DAAY;AAC3B;AACA,oBAAoB,uEAAoB;AACxC,2BAA2B,iEAAc;AACzC,cAAc,8DAAW;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,2BAA2B,sEAAa;AACxC;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA,iEAAe,OAAO,EAAC;;;;;;;;;;;;;;;;;;;;;;;;;;AClDwB;AACE;AACG;AAClB;AAClC;AACA;AAC0E;AAC1E;AACyG;AAC9B;AACG;AAC9E;AACA;AACA;AACO,4BAA4B,2DAAU;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,8DAAe;AACnD,0BAA0B,8DAAe;AACzC,eAAe,aAAa;AAC5B,wCAAwC,kGAAkB;AAC1D,2CAA2C,8DAAW;AACtD,8BAA8B,8EAAQ;AACtC,iCAAiC,8DAAW;AAC5C,+BAA+B,gFAAS;AACxC,kCAAkC,8DAAW;AAC7C,0FAA0F,8EAAO;AACjG,gCAAgC,8DAAW;AAC3C;AACA;AACA;AACA,kCAAkC,WAAW,GAAG;AAChD,mCAAmC,SAAS,EAAE;AAC9C,sDAAsD,2BAA2B,EAAE;AACnF,4CAA4C,iBAAiB,EAAE;AAC/D,6CAA6C,kBAAkB,EAAE;AACjE,2CAA2C,gBAAgB,EAAE;AAC7D,gBAAgB,wCAAM;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,QAAQ;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mFAAmF;AACnF;AACA;AACA;AACA;AACA,oFAAoF;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mFAAmF,SAAS,cAAc,eAAe;AACzH;AACA;AACA;AACA;AACA,mFAAmF,SAAS,cAAc,eAAe;AACzH;AACA;AACA;AACA;AACA,mFAAmF;AACnF;AACA;AACA;AACA;AACA,mFAAmF,6BAA6B,cAAc;AAC9H;AACA;AACA;AACA;AACA,mFAAmF;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,8DAAe;AACnD,kCAAkC,kCAAkC;AACpE;AACA;AACA","file":"packages_pyolite-kernel-extension_lib_index_js.79a7aa7b780639d91ff8.js","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { PageConfig, URLExt } from '@jupyterlab/coreutils';\nimport { IKernelSpecs } from '@jupyterlite/kernel';\nimport { PyoliteKernel } from '@jupyterlite/pyolite-kernel';\n/**\n * The default CDN fallback for Pyodide\n */\nconst PYODIDE_CDN_URL = 'https://cdn.jsdelivr.net/pyodide/v0.18.0/full/pyodide.js';\n/**\n * A plugin to register the Pyodide kernel.\n */\nconst kernel = {\n    id: '@jupyterlite/pyolite-kernel-extension:kernel',\n    autoStart: true,\n    requires: [IKernelSpecs],\n    activate: (app, kernelspecs) => {\n        const url = PageConfig.getOption('pyodideUrl') || PYODIDE_CDN_URL;\n        const pyodideUrl = URLExt.isLocal(url)\n            ? URLExt.join(window.location.origin, url)\n            : url;\n        kernelspecs.register({\n            spec: {\n                name: 'python',\n                display_name: 'Pyolite',\n                language: 'python',\n                argv: [],\n                spec: {\n                    argv: [],\n                    env: {},\n                    display_name: 'Pyolite',\n                    language: 'python',\n                    interrupt_mode: 'message',\n                    metadata: {}\n                },\n                resources: {\n                    'logo-32x32': 'TODO',\n                    'logo-64x64': '/kernelspecs/python.png'\n                }\n            },\n            create: async (options) => {\n                return new PyoliteKernel({\n                    ...options,\n                    pyodideUrl\n                });\n            }\n        });\n    }\n};\nconst plugins = [kernel];\nexport default plugins;\n","import { URLExt } from '@jupyterlab/coreutils';\nimport { BaseKernel } from '@jupyterlite/kernel';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport worker from './worker?raw';\n// TODO: see https://github.com/jupyterlite/jupyterlite/issues/151\n// TODO: sync this version with the npm version (despite version mangling)\nimport pyolite from '../py/pyolite/dist/pyolite-0.1.0a6-py3-none-any.whl';\n// TODO: sync this version with the pypi version\nimport widgetsnbextension from '../py/widgetsnbextension/dist/widgetsnbextension-3.5.0-py3-none-any.whl';\nimport nbformat from '../py/nbformat/dist/nbformat-4.2.0-py3-none-any.whl';\nimport ipykernel from '../py/ipykernel/dist/ipykernel-5.5.5-py3-none-any.whl';\n/**\n * A kernel that executes Python code with Pyodide.\n */\nexport class PyoliteKernel extends BaseKernel {\n    /**\n     * Instantiate a new PyodideKernel\n     *\n     * @param options The instantiation options for a new PyodideKernel\n     */\n    constructor(options) {\n        var _a;\n        super(options);\n        this._executeDelegate = new PromiseDelegate();\n        this._ready = new PromiseDelegate();\n        const { pyodideUrl } = options;\n        const widgetsnbextensionWheel = widgetsnbextension;\n        const widgetsnbextensionWheelUrl = URLExt.join(window.location.origin, widgetsnbextensionWheel);\n        const nbformatWheel = nbformat;\n        const nbformatWheelUrl = URLExt.join(window.location.origin, nbformatWheel);\n        const ipykernelWheel = ipykernel;\n        const ipykernelWheelUrl = URLExt.join(window.location.origin, ipykernelWheel);\n        const pyoliteWheel = (_a = options.pyoliteWheel) !== null && _a !== void 0 ? _a : pyolite;\n        const pyoliteWheelUrl = URLExt.join(window.location.origin, pyoliteWheel);\n        const indexUrl = pyodideUrl.slice(0, pyodideUrl.lastIndexOf('/') + 1);\n        const blob = new Blob([\n            [\n                `importScripts(\"${pyodideUrl}\");`,\n                `var indexURL = \"${indexUrl}\";`,\n                `var _widgetsnbextensionWheelUrl = '${widgetsnbextensionWheelUrl}';`,\n                `var _nbformatWheelUrl = '${nbformatWheelUrl}';`,\n                `var _ipykernelWheelUrl = '${ipykernelWheelUrl}';`,\n                `var _pyoliteWheelUrl = '${pyoliteWheelUrl}';`,\n                worker\n            ].join('\\n')\n        ]);\n        this._worker = new Worker(window.URL.createObjectURL(blob));\n        this._worker.onmessage = e => {\n            this._processWorkerMessage(e.data);\n        };\n        this._ready.resolve();\n    }\n    /**\n     * Dispose the kernel.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        console.log(`Dispose worker for kernel ${this.id}`);\n        this._worker.terminate();\n        super.dispose();\n    }\n    /**\n     * A promise that is fulfilled when the kernel is ready.\n     */\n    get ready() {\n        return this._ready.promise;\n    }\n    /**\n     * Process a message coming from the pyodide web worker.\n     *\n     * @param msg The worker message to process.\n     */\n    _processWorkerMessage(msg) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        switch (msg.type) {\n            case 'stream': {\n                const bundle = (_a = msg.bundle) !== null && _a !== void 0 ? _a : { name: 'stdout', text: '' };\n                this.stream(bundle);\n                break;\n            }\n            case 'input_request': {\n                const bundle = (_b = msg.content) !== null && _b !== void 0 ? _b : { prompt: '', password: false };\n                this.inputRequest(bundle);\n                break;\n            }\n            case 'reply': {\n                const bundle = msg.results;\n                this._executeDelegate.resolve(bundle);\n                break;\n            }\n            case 'display_data': {\n                const bundle = (_c = msg.bundle) !== null && _c !== void 0 ? _c : { data: {}, metadata: {}, transient: {} };\n                this.displayData(bundle);\n                break;\n            }\n            case 'update_display_data': {\n                const bundle = (_d = msg.bundle) !== null && _d !== void 0 ? _d : { data: {}, metadata: {}, transient: {} };\n                this.updateDisplayData(bundle);\n                break;\n            }\n            case 'clear_output': {\n                const bundle = (_e = msg.bundle) !== null && _e !== void 0 ? _e : { wait: false };\n                this.clearOutput(bundle);\n                break;\n            }\n            case 'execute_result': {\n                const bundle = (_f = msg.bundle) !== null && _f !== void 0 ? _f : { execution_count: 0, data: {}, metadata: {} };\n                this.publishExecuteResult(bundle);\n                break;\n            }\n            case 'execute_error': {\n                const bundle = (_g = msg.bundle) !== null && _g !== void 0 ? _g : { ename: '', evalue: '', traceback: [] };\n                this.publishExecuteError(bundle);\n                break;\n            }\n            case 'comm_msg':\n            case 'comm_open':\n            case 'comm_close': {\n                this.handleComm(msg.type, msg.content, msg.metadata, msg.buffers);\n                break;\n            }\n            default:\n                this._executeDelegate.resolve({\n                    data: {},\n                    metadata: {}\n                });\n                break;\n        }\n    }\n    /**\n     * Handle a kernel_info_request message\n     */\n    async kernelInfoRequest() {\n        const content = {\n            implementation: 'pyodide',\n            implementation_version: '0.1.0',\n            language_info: {\n                codemirror_mode: {\n                    name: 'python',\n                    version: 3\n                },\n                file_extension: '.py',\n                mimetype: 'text/x-python',\n                name: 'python',\n                nbconvert_exporter: 'python',\n                pygments_lexer: 'ipython3',\n                version: '3.8'\n            },\n            protocol_version: '5.3',\n            status: 'ok',\n            banner: 'Pyolite: A WebAssembly-powered Python kernel backed by Pyodide',\n            help_links: [\n                {\n                    text: 'Python (WASM) Kernel',\n                    url: 'https://pyodide.org'\n                }\n            ]\n        };\n        return content;\n    }\n    /**\n     * Handle an `execute_request` message\n     *\n     * @param msg The parent message.\n     */\n    async executeRequest(content) {\n        const result = await this._sendRequestMessageToWorker('execute-request', content);\n        return {\n            execution_count: this.executionCount,\n            ...result\n        };\n    }\n    /**\n     * Handle an complete_request message\n     *\n     * @param msg The parent message.\n     */\n    async completeRequest(content) {\n        return await this._sendRequestMessageToWorker('complete-request', content);\n    }\n    /**\n     * Handle an `inspect_request` message.\n     *\n     * @param content - The content of the request.\n     *\n     * @returns A promise that resolves with the response message.\n     */\n    async inspectRequest(content) {\n        return await this._sendRequestMessageToWorker('inspect-request', content);\n    }\n    /**\n     * Handle an `is_complete_request` message.\n     *\n     * @param content - The content of the request.\n     *\n     * @returns A promise that resolves with the response message.\n     */\n    async isCompleteRequest(content) {\n        return await this._sendRequestMessageToWorker('is-complete-request', content);\n    }\n    /**\n     * Handle a `comm_info_request` message.\n     *\n     * @param content - The content of the request.\n     *\n     * @returns A promise that resolves with the response message.\n     */\n    async commInfoRequest(content) {\n        return await this._sendRequestMessageToWorker('comm-info-request', content);\n    }\n    /**\n     * Send an `input_reply` message.\n     *\n     * @param content - The content of the reply.\n     */\n    inputReply(content) {\n        this._worker.postMessage({\n            type: 'input-reply',\n            data: content,\n            parent: this.parent\n        });\n    }\n    /**\n     * Send an `comm_open` message.\n     *\n     * @param msg - The comm_open message.\n     */\n    async commOpen(msg) {\n        return await this._sendRequestMessageToWorker('comm-open', msg);\n    }\n    /**\n     * Send an `comm_msg` message.\n     *\n     * @param msg - The comm_msg message.\n     */\n    async commMsg(msg) {\n        return await this._sendRequestMessageToWorker('comm-msg', msg);\n    }\n    /**\n     * Send an `comm_close` message.\n     *\n     * @param close - The comm_close message.\n     */\n    async commClose(msg) {\n        return await this._sendRequestMessageToWorker('comm-close', msg);\n    }\n    /**\n     * Send a message to the web worker\n     *\n     * @param type The message type to send to the worker.\n     * @param data The message to send to the worker.\n     */\n    async _sendRequestMessageToWorker(type, data) {\n        this._executeDelegate = new PromiseDelegate();\n        this._worker.postMessage({ type, data, parent: this.parent });\n        return await this._executeDelegate.promise;\n    }\n}\n"],"sourceRoot":""}