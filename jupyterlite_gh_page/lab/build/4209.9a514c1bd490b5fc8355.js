(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4209],{44209:(t,e,s)=>{"use strict";s.r(e),s.d(e,{ISettingEditorTracker:()=>R,SettingEditor:()=>x});var i,n=s(57630),r=s(65995),a=s(9727),o=s(61389),d=s(2411),l=s(43006),h=s(18477),c=s(75138),u=s(6256),g=s(42767),_=s(34410),p=s(44011);class m extends p.DataConnector{constructor(t,e){super(),this._current=0,this.translator=e||n.nullTranslator,this._editor=t,this._trans=this.translator.load("jupyterlab")}fetch(t){return new Promise((e=>{const s=this._current=window.setTimeout((()=>{if(s!==this._current)return e(void 0);const n=this._validate(t.text);if(!n)return e({data:{"text/markdown":this._trans.__("No errors found")},metadata:{}});e({data:i.render(n),metadata:{}})}),100)}))}_validate(t){const e=this._editor;if(!e.settings)return null;const{id:s,schema:i,version:n}=e.settings;return e.registry.validator.validateData({data:{composite:{},user:{}},id:s,raw:t,schema:i,version:n},!1)}}!function(t){function e(t){var e;switch(t.keyword){case"additionalProperties":return`**\`[additional property error]\`**\n          \`${null===(e=t.params)||void 0===e?void 0:e.additionalProperty}\` is not a valid property`;case"syntax":return`**\`[syntax error]\`** *${t.message}*`;case"type":return`**\`[type error]\`**\n          \`${t.dataPath}\` ${t.message}`;default:return`**\`[error]\`** *${t.message}*`}}t.render=function(t){return{"text/markdown":t.map(e).join("")}}}(i||(i={}));class v extends o.SplitPanel{constructor(){super(...arguments),this.handleMoved=new c.Signal(this)}handleEvent(t){super.handleEvent(t),"mouseup"===t.type&&this.handleMoved.emit(void 0)}}const y="jp-mod-error";class f extends v{constructor(t){super({orientation:"horizontal",renderer:v.defaultRenderer,spacing:1}),this._canRevert=!1,this._canSave=!1,this._commandsChanged=new c.Signal(this),this._settings=null,this._toolbar=new h.Toolbar;const{commands:e,editorFactory:s,registry:i,translator:r}=t;this.registry=i,this.translator=r||n.nullTranslator,this._commands=e;const a=this._defaults=new u.CodeEditorWrapper({model:new u.CodeEditor.Model,factory:s});a.editor.model.value.text="",a.editor.model.mimeType="text/javascript",a.editor.setOption("readOnly",!0);const o=this._user=new u.CodeEditorWrapper({model:new u.CodeEditor.Model,factory:s,config:{lineNumbers:!0}});o.addClass("jp-SettingsRawEditor-user"),o.editor.model.mimeType="text/javascript",o.editor.model.value.changed.connect(this._onTextChanged,this),this._inspector=function(t,e,s){const i=(s=s||n.nullTranslator).load("jupyterlab"),r=new m(t,s),a=new g.InspectorPanel({initialContent:i.__("Any errors will be listed here"),translator:s}),o=new g.InspectionHandler({connector:r,rendermime:e||new _.RenderMimeRegistry({initialFactories:_.standardRendererFactories,translator:s})});return a.addClass("jp-SettingsDebug"),a.source=o,o.editor=t.source,a}(this,t.rendermime,this.translator),this.addClass("jp-SettingsRawEditor"),this._onSaveError=t.onSaveError,this.addWidget(w.defaultsEditor(a,this.translator)),this.addWidget(w.userEditor(o,this._toolbar,this._inspector,this.translator))}get canRevert(){return this._canRevert}get canSave(){return this._canSave}get commandsChanged(){return this._commandsChanged}get isDirty(){var t,e;return null!==(e=this._user.editor.model.value.text!==(null===(t=this._settings)||void 0===t?void 0:t.raw))&&void 0!==e?e:""}get settings(){return this._settings}set settings(t){if(!t&&!this._settings)return;if(t&&this._settings&&t.plugin===this._settings.plugin)return;const e=this._defaults,s=this._user;this._settings&&this._settings.changed.disconnect(this._onSettingsChanged,this),t?(this._settings=t,this._settings.changed.connect(this._onSettingsChanged,this),this._onSettingsChanged()):(this._settings=null,e.editor.model.value.text="",s.editor.model.value.text=""),this.update()}get sizes(){return this.relativeSizes()}set sizes(t){this.setRelativeSizes(t)}get source(){return this._user.editor}dispose(){this.isDisposed||(super.dispose(),this._defaults.dispose(),this._user.dispose())}revert(){var t,e;this._user.editor.model.value.text=null!==(e=null===(t=this.settings)||void 0===t?void 0:t.raw)&&void 0!==e?e:"",this._updateToolbar(!1,!1)}save(){if(!this.isDirty||!this._settings)return Promise.resolve(void 0);const t=this._settings,e=this._user.editor.model.value.text;return t.save(e).then((()=>{this._updateToolbar(!1,!1)})).catch((t=>{this._updateToolbar(!0,!1),this._onSaveError(t,this.translator)}))}onAfterAttach(t){w.populateToolbar(this._commands,this._toolbar),this.update()}onUpdateRequest(t){const e=this._settings,s=this._defaults,i=this._user;e&&(s.editor.refresh(),i.editor.refresh())}_onTextChanged(){const t=this._user.editor.model.value.text,e=this._settings;if(this.removeClass(y),e&&e.raw!==t)return e.validate(t)?(this.addClass(y),void this._updateToolbar(!0,!1)):void this._updateToolbar(!0,!0);this._updateToolbar(!1,!1)}_onSettingsChanged(){var t,e;const s=this._settings,i=this._defaults,n=this._user;i.editor.model.value.text=null!==(t=null==s?void 0:s.annotatedDefaults())&&void 0!==t?t:"",n.editor.model.value.text=null!==(e=null==s?void 0:s.raw)&&void 0!==e?e:""}_updateToolbar(t=this._canRevert,e=this._canSave){const s=this._commands;this._canRevert=t,this._canSave=e,this._commandsChanged.emit([s.revert,s.save])}}var w,S,E;!function(t){t.defaultsEditor=function(t,e){const s=(e=e||n.nullTranslator).load("jupyterlab"),i=new o.Widget,r=i.layout=new o.BoxLayout({spacing:0}),a=new o.Widget,d=new h.Toolbar,l=s.__("System Defaults");return a.node.innerText=l,d.insertItem(0,"banner",a),r.addWidget(d),r.addWidget(t),i},t.populateToolbar=function(t,e){const{registry:s,revert:i,save:n}=t;e.addItem("spacer",h.Toolbar.createSpacerItem()),[i,n].forEach((t=>{const i=new h.CommandToolbarButton({commands:s,id:t});e.addItem(t,i)}))},t.userEditor=function(t,e,s,i){const r=(i=i||n.nullTranslator).load("jupyterlab").__("User Preferences"),a=new o.Widget,d=a.layout=new o.BoxLayout({spacing:0}),l=new o.Widget;return l.node.innerText=r,e.insertItem(0,"banner",l),d.addWidget(e),d.addWidget(t),d.addWidget(s),a}}(w||(w={}));class C extends o.Widget{constructor(t){super(),this._settings=null,this._stateChanged=new c.Signal(this),this.addClass("jp-PluginEditor");const{commands:e,editorFactory:s,registry:i,rendermime:r,translator:a}=t;this.translator=a||n.nullTranslator,this._trans=this.translator.load("jupyterlab");const d=this.layout=new o.StackedLayout,{onSaveError:l}=S;this.raw=this._rawEditor=new f({commands:e,editorFactory:s,onSaveError:l,registry:i,rendermime:r,translator:a}),this._rawEditor.handleMoved.connect(this._onStateChanged,this),d.addWidget(this._rawEditor)}get isDirty(){return this._rawEditor.isDirty}get settings(){return this._settings}set settings(t){if(this._settings===t)return;const e=this._rawEditor;this._settings=e.settings=t,this.update()}get state(){const t=this._settings?this._settings.id:"",{sizes:e}=this._rawEditor;return{plugin:t,sizes:e}}set state(t){a.JSONExt.deepEqual(this.state,t)||(this._rawEditor.sizes=t.sizes,this.update())}get stateChanged(){return this._stateChanged}confirm(){return!this.isHidden&&this.isAttached&&this.isDirty?(0,h.showDialog)({title:this._trans.__("You have unsaved changes."),body:this._trans.__("Do you want to leave without saving?"),buttons:[h.Dialog.cancelButton({label:this._trans.__("Cancel")}),h.Dialog.okButton({label:this._trans.__("Ok")})]}).then((t=>{if(!t.button.accept)throw new Error("User canceled.")})):Promise.resolve(void 0)}dispose(){this.isDisposed||(super.dispose(),this._rawEditor.dispose())}onAfterAttach(t){this.update()}onUpdateRequest(t){const e=this._rawEditor;this._settings?(this.show(),e.show()):this.hide()}_onStateChanged(){this.stateChanged.emit(void 0)}}!function(t){t.onSaveError=function(t,e){const s=(e=e||n.nullTranslator).load("jupyterlab");console.error(`Saving setting editor value failed: ${t.message}`),(0,h.showDialog)({title:s.__("Your changes were not saved."),body:t.message,buttons:[h.Dialog.okButton({label:s.__("Ok")})]})}}(S||(S={}));class b extends o.Widget{constructor(t){super(),this._changed=new c.Signal(this),this._scrollTop=0,this._selection="",this.registry=t.registry,this.translator=t.translator||n.nullTranslator,this.addClass("jp-PluginList"),this._confirm=t.confirm,this.registry.pluginChanged.connect((()=>{this.update()}),this)}get changed(){return this._changed}get scrollTop(){var t;return null===(t=this.node.querySelector("ul"))||void 0===t?void 0:t.scrollTop}get selection(){return this._selection}set selection(t){this._selection!==t&&(this._selection=t,this.update())}handleEvent(t){switch(t.type){case"mousedown":this._evtMousedown(t)}}onAfterAttach(t){this.node.addEventListener("mousedown",this),this.update()}onBeforeDetach(t){this.node.removeEventListener("mousedown",this)}onUpdateRequest(t){const{node:e,registry:s}=this,i=this._selection,n=this.translator;E.populateList(s,i,e,n);const r=e.querySelector("ul");r&&void 0!==this._scrollTop&&(r.scrollTop=this._scrollTop)}_evtMousedown(t){t.preventDefault();let e=t.target,s=e.getAttribute("data-id");if(s!==this._selection){if(!s)for(;!s&&e!==this.node;)e=e.parentElement,s=e.getAttribute("data-id");s&&this._confirm().then((()=>{this._scrollTop=this.scrollTop,this._selection=s,this._changed.emit(void 0),this.update()})).catch((()=>{}))}}}!function(t){function e(t,e,s){let i=s.data.user[t];if(i||(i=s.data.composite[t]),i||(i=s.schema[t]),!i){const{properties:s}=e.schema;i=s&&s[t]&&s[t].default}return"string"==typeof i?i:""}t.populateList=function(t,s,i,a){const o=(a=a||n.nullTranslator).load("jupyterlab"),h=function(t){return Object.keys(t.plugins).map((e=>t.plugins[e])).sort(((t,e)=>(t.schema.title||t.id).localeCompare(e.schema.title||e.id)))}(t).filter((t=>{const{schema:e}=t,s=!0===e["jupyter.lab.setting-deprecated"],i=Object.keys(e.properties||{}).length>0,n=!1!==e.additionalProperties;return!s&&(i||n)})).map((i=>{const{id:n,schema:a,version:l}=i,h="string"==typeof a.title?o._p("schema",a.title):n,c=`${"string"==typeof a.description?o._p("schema",a.description):""}\n${n}\n${l}`,u=e("jupyter.lab.setting-icon",t,i),g=e("jupyter.lab.setting-icon-class",t,i),_=e("jupyter.lab.setting-icon-label",t,i);return d.createElement("li",{className:n===s?"jp-mod-selected":"","data-id":n,key:n,title:c},d.createElement(r.LabIcon.resolveReact,{icon:u||(g?void 0:r.settingsIcon),iconClass:(0,r.classes)(g,"jp-Icon"),title:_,tag:"span",stylesheet:"settingsEditor"}),d.createElement("span",null,h))}));l.unmountComponentAtNode(i),l.render(d.createElement("ul",null,h),i)}}(E||(E={}));const T={sizes:[1,3],container:{editor:"raw",plugin:"",sizes:[1,1]}};class x extends o.Widget{constructor(t){super(),this._fetching=null,this._saving=!1,this._state=a.JSONExt.deepCopy(T),this.translator=t.translator||n.nullTranslator,this.addClass("jp-SettingEditor"),this.key=t.key,this.state=t.state;const{commands:e,editorFactory:s,rendermime:i}=t,r=this.layout=new o.PanelLayout,d=this.registry=t.registry,l=this._panel=new v({orientation:"horizontal",renderer:v.defaultRenderer,spacing:1}),h=this._instructions=new o.Widget,c=this._editor=new C({commands:e,editorFactory:s,registry:d,rendermime:i,translator:this.translator}),u=this._list=new b({confirm:()=>c.confirm(),registry:d,translator:this.translator}),g=t.when;h.addClass("jp-SettingEditorInstructions"),j.populateInstructionsNode(h.node,this.translator),g&&(this._when=Array.isArray(g)?Promise.all(g):g),l.addClass("jp-SettingEditor-main"),r.addWidget(l),l.addWidget(u),l.addWidget(h),v.setStretch(u,0),v.setStretch(h,1),v.setStretch(c,1),c.stateChanged.connect(this._onStateChanged,this),u.changed.connect(this._onStateChanged,this),l.handleMoved.connect(this._onStateChanged,this)}get canRevertRaw(){return this._editor.raw.canRevert}get canSaveRaw(){return this._editor.raw.canSave}get commandsChanged(){return this._editor.raw.commandsChanged}get settings(){return this._editor.settings}get source(){return this._editor.raw.source}dispose(){this.isDisposed||(super.dispose(),this._editor.dispose(),this._instructions.dispose(),this._list.dispose(),this._panel.dispose())}revert(){this._editor.raw.revert()}save(){return this._editor.raw.save()}onAfterAttach(t){super.onAfterAttach(t),this._panel.hide(),this._fetchState().then((()=>{this._panel.show(),this._setState()})).catch((t=>{console.error("Fetching setting editor state failed",t),this._panel.show(),this._setState()}))}onCloseRequest(t){this._editor.confirm().then((()=>{super.onCloseRequest(t),this.dispose()})).catch((()=>{}))}_fetchState(){if(this._fetching)return this._fetching;const{key:t,state:e}=this,s=[e.fetch(t),this._when];return this._fetching=Promise.all(s).then((([t])=>{this._fetching=null,this._saving||(this._state=j.normalizeState(t,this._state))}))}async _onStateChanged(){this._state.sizes=this._panel.relativeSizes(),this._state.container=this._editor.state,this._state.container.plugin=this._list.selection;try{await this._saveState()}catch(t){console.error("Saving setting editor state failed",t)}this._setState()}async _saveState(){const{key:t,state:e}=this,s=this._state;this._saving=!0;try{await e.save(t,s),this._saving=!1}catch(t){throw this._saving=!1,t}}_setLayout(){const t=this._editor,e=this._panel,s=this._state;t.state=s.container,requestAnimationFrame((()=>{e.setRelativeSizes(s.sizes)}))}_setState(){const t=this._editor,e=this._list,s=this._panel,{container:i}=this._state;if(!i.plugin)return t.settings=null,e.selection="",void this._setLayout();if(t.settings&&t.settings.id===i.plugin)return void this._setLayout();const n=this._instructions;this.registry.load(i.plugin).then((r=>{n.isAttached&&(n.parent=null),t.isAttached||s.addWidget(t),t.settings=r,e.selection=i.plugin,this._setLayout()})).catch((s=>{console.error(`Loading ${i.plugin} settings failed.`,s),e.selection=this._state.container.plugin="",t.settings=null,this._setLayout()}))}}var j;!function(t){function e(t){return Array.isArray(t)&&t.every((t=>"number"==typeof t))}t.populateInstructionsNode=function(t,e){const s=(e=e||n.nullTranslator).load("jupyterlab");l.render(d.createElement(d.Fragment,null,d.createElement("h2",null,d.createElement(r.jupyterIcon.react,{className:"jp-SettingEditorInstructions-icon",tag:"span",elementPosition:"center",height:"auto",width:"60px"}),d.createElement("span",{className:"jp-SettingEditorInstructions-title"},"Settings")),d.createElement("span",{className:"jp-SettingEditorInstructions-text"},s.__("Select a plugin from the list to view and edit its preferences."))),t)},t.normalizeState=function(t,s){if(!t)return a.JSONExt.deepCopy(T);if("sizes"in t&&e(t.sizes)||(t.sizes=a.JSONExt.deepCopy(T.sizes)),!("container"in t))return t.container=a.JSONExt.deepCopy(T.container),t;const i="container"in t&&t.container&&"object"==typeof t.container?t.container:{};return t.container={plugin:"string"==typeof i.plugin?i.plugin:T.container.plugin,sizes:e(i.sizes)?i.sizes:a.JSONExt.deepCopy(T.container.sizes)},t}}(j||(j={}));const R=new a.Token("@jupyterlab/settingeditor:ISettingEditorTracker")}}]);
//# sourceMappingURL=4209.9a514c1bd490b5fc8355.js.map