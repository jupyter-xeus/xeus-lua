{"version":3,"sources":["webpack://_JUPYTERLAB.CORE_OUTPUT/../node_modules/@jupyterlab/imageviewer/lib/tokens.js","webpack://_JUPYTERLAB.CORE_OUTPUT/../node_modules/@jupyterlab/imageviewer/lib/widget.js"],"names":["IImageTracker","Token","Private","ImageViewer","Widget","constructor","context","super","this","_scale","_matrix","_colorinversion","_ready","PromiseDelegate","node","tabIndex","addClass","_img","document","createElement","appendChild","_onTitleChanged","pathChanged","connect","ready","then","isDisposed","contents","contentsModel","_mimeType","mimetype","_render","model","contentChanged","update","fileChanged","resolve","Printing","promise","value","_updateStyle","dispose","src","URL","revokeObjectURL","resetRotationFlip","rotateCounterclockwise","prod","rotateCounterclockwiseMatrix","rotateClockwise","rotateClockwiseMatrix","flipHorizontal","flipHMatrix","flipVertical","flipVMatrix","onUpdateRequest","msg","isReady","onActivateRequest","focus","title","label","PathExt","localPath","cm","oldurl","content","toString","format","a","Blob","type","createObjectURL","b","c","d","tX","tY","prodVec","transform","style","filter","ImageViewerFactory","ABCWidgetFactory","createNewWidget","DocumentWidget","a11","a12","a21","a22","b11","b12","b21","b22","b1","b2"],"mappings":"qOAOO,MAAMA,EAAgB,IAAI,EAAAC,MAAM,yC,IC0LnCC,E,4CAnLG,MAAMC,UAAoB,EAAAC,OAI7BC,YAAYC,GACRC,QACAC,KAAKC,OAAS,EACdD,KAAKE,QAAU,CAAC,EAAG,EAAG,EAAG,GACzBF,KAAKG,gBAAkB,EACvBH,KAAKI,OAAS,IAAI,EAAAC,gBAClBL,KAAKF,QAAUA,EACfE,KAAKM,KAAKC,SAAW,EACrBP,KAAKQ,SAhBO,kBAiBZR,KAAKS,KAAOC,SAASC,cAAc,OACnCX,KAAKM,KAAKM,YAAYZ,KAAKS,MAC3BT,KAAKa,kBACLf,EAAQgB,YAAYC,QAAQf,KAAKa,gBAAiBb,MAC7CF,EAAQkB,MAAMC,MAAK,KACpB,GAAIjB,KAAKkB,WACL,OAEJ,MAAMC,EAAWrB,EAAQsB,cACzBpB,KAAKqB,UAAYF,EAASG,SAC1BtB,KAAKuB,UACLzB,EAAQ0B,MAAMC,eAAeV,QAAQf,KAAK0B,OAAQ1B,MAClDF,EAAQ6B,YAAYZ,QAAQf,KAAK0B,OAAQ1B,MACzCA,KAAKI,OAAOwB,aAAQ,MAM5B,CAAC,EAAAC,SAAA,UACG,MAAO,IAAM,EAAAA,SAAA,YAAqB7B,MAKtC,YACI,OAAOA,KAAKI,OAAO0B,QAKvB,YACI,OAAO9B,KAAKC,OAEhB,UAAU8B,GACFA,IAAU/B,KAAKC,SAGnBD,KAAKC,OAAS8B,EACd/B,KAAKgC,gBAKT,qBACI,OAAOhC,KAAKG,gBAEhB,mBAAmB4B,GACXA,IAAU/B,KAAKG,kBAGnBH,KAAKG,gBAAkB4B,EACvB/B,KAAKgC,gBAKTC,UACQjC,KAAKS,KAAKyB,KACVC,IAAIC,gBAAgBpC,KAAKS,KAAKyB,KAAO,IAEzCnC,MAAMkC,UAKVI,oBACIrC,KAAKE,QAAU,CAAC,EAAG,EAAG,EAAG,GACzBF,KAAKgC,eAKTM,yBACItC,KAAKE,QAAUR,EAAQ6C,KAAKvC,KAAKE,QAASR,EAAQ8C,8BAClDxC,KAAKgC,eAKTS,kBACIzC,KAAKE,QAAUR,EAAQ6C,KAAKvC,KAAKE,QAASR,EAAQgD,uBAClD1C,KAAKgC,eAKTW,iBACI3C,KAAKE,QAAUR,EAAQ6C,KAAKvC,KAAKE,QAASR,EAAQkD,aAClD5C,KAAKgC,eAKTa,eACI7C,KAAKE,QAAUR,EAAQ6C,KAAKvC,KAAKE,QAASR,EAAQoD,aAClD9C,KAAKgC,eAKTe,gBAAgBC,IACRhD,KAAKkB,YAAelB,KAAKF,QAAQmD,SAGrCjD,KAAKuB,UAKT2B,kBAAkBF,GACdhD,KAAKM,KAAK6C,QAKdtC,kBACIb,KAAKoD,MAAMC,MAAQ,EAAAC,QAAA,SAAiBtD,KAAKF,QAAQyD,WAKrDhC,UACI,MAAMzB,EAAUE,KAAKF,QACf0D,EAAK1D,EAAQsB,cACnB,IAAKoC,EACD,OAEJ,MAAMC,EAASzD,KAAKS,KAAKyB,KAAO,GAChC,IAAIwB,EAAU5D,EAAQ0B,MAAMmC,WAC5B,GAAkB,WAAdH,EAAGI,OACH5D,KAAKS,KAAKyB,IAAM,QAAQlC,KAAKqB,oBAAoBqC,QAEhD,CACD,MAAMG,EAAI,IAAIC,KAAK,CAACJ,GAAU,CAAEK,KAAM/D,KAAKqB,YAC3CrB,KAAKS,KAAKyB,IAAMC,IAAI6B,gBAAgBH,GAExC1B,IAAIC,gBAAgBqB,GAKxBzB,eACI,MAAO6B,EAAGI,EAAGC,EAAGC,GAAKnE,KAAKE,SACnBkE,EAAIC,GAAM3E,EAAQ4E,QAAQtE,KAAKE,QAAS,CAAC,EAAG,IAC7CqE,EAAY,UAAUV,MAAMI,MAAMC,MAAMC,sBAAsBC,EAAK,GAAK,IAAM,OAAOC,EAAK,GAAK,IAAM,OAC3GrE,KAAKS,KAAK+D,MAAMD,UAAY,SAASvE,KAAKC,WAAWsE,IACrDvE,KAAKS,KAAK+D,MAAMC,OAAS,UAAUzE,KAAKG,oBAMzC,MAAMuE,UAA2B,EAAAC,iBAIpCC,gBAAgB9E,GACZ,MAAM4D,EAAU,IAAI/D,EAAYG,GAEhC,OADe,IAAI,EAAA+E,eAAe,CAAEnB,UAAS5D,cAQrD,SAAWJ,GAYPA,EAAQ6C,KARR,UAAeuC,EAAKC,EAAKC,EAAKC,IAAOC,EAAKC,EAAKC,EAAKC,IAChD,MAAO,CACHP,EAAMI,EAAMH,EAAMK,EAClBN,EAAMK,EAAMJ,EAAMM,EAClBL,EAAME,EAAMD,EAAMG,EAClBJ,EAAMG,EAAMF,EAAMI,IAU1B3F,EAAQ4E,QAHR,UAAkBQ,EAAKC,EAAKC,EAAKC,IAAOK,EAAIC,IACxC,MAAO,CAACT,EAAMQ,EAAKP,EAAMQ,EAAIP,EAAMM,EAAKL,EAAMM,IAMlD7F,EAAQgD,sBAAwB,CAAC,EAAG,GAAI,EAAG,GAI3ChD,EAAQ8C,6BAA+B,CAAC,GAAI,EAAG,EAAG,GAIlD9C,EAAQkD,YAAc,EAAE,EAAG,EAAG,EAAG,GAIjClD,EAAQoD,YAAc,CAAC,EAAG,EAAG,GAAI,GAnCrC,CAoCGpD,IAAYA,EAAU","file":"6381.320c006471e2f964cecd.js","sourcesContent":["// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { Token } from '@lumino/coreutils';\n/* tslint:disable */\n/**\n * The image tracker token.\n */\nexport const IImageTracker = new Token('@jupyterlab/imageviewer:IImageTracker');\n/* tslint:enable */\n//# sourceMappingURL=tokens.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { PathExt } from '@jupyterlab/coreutils';\nimport { Printing } from '@jupyterlab/apputils';\nimport { ABCWidgetFactory, DocumentWidget } from '@jupyterlab/docregistry';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { Widget } from '@lumino/widgets';\n/**\n * The class name added to a imageviewer.\n */\nconst IMAGE_CLASS = 'jp-ImageViewer';\n/**\n * A widget for images.\n */\nexport class ImageViewer extends Widget {\n    /**\n     * Construct a new image widget.\n     */\n    constructor(context) {\n        super();\n        this._scale = 1;\n        this._matrix = [1, 0, 0, 1];\n        this._colorinversion = 0;\n        this._ready = new PromiseDelegate();\n        this.context = context;\n        this.node.tabIndex = 0;\n        this.addClass(IMAGE_CLASS);\n        this._img = document.createElement('img');\n        this.node.appendChild(this._img);\n        this._onTitleChanged();\n        context.pathChanged.connect(this._onTitleChanged, this);\n        void context.ready.then(() => {\n            if (this.isDisposed) {\n                return;\n            }\n            const contents = context.contentsModel;\n            this._mimeType = contents.mimetype;\n            this._render();\n            context.model.contentChanged.connect(this.update, this);\n            context.fileChanged.connect(this.update, this);\n            this._ready.resolve(void 0);\n        });\n    }\n    /**\n     * Print in iframe.\n     */\n    [Printing.symbol]() {\n        return () => Printing.printWidget(this);\n    }\n    /**\n     * A promise that resolves when the image viewer is ready.\n     */\n    get ready() {\n        return this._ready.promise;\n    }\n    /**\n     * The scale factor for the image.\n     */\n    get scale() {\n        return this._scale;\n    }\n    set scale(value) {\n        if (value === this._scale) {\n            return;\n        }\n        this._scale = value;\n        this._updateStyle();\n    }\n    /**\n     * The color inversion of the image.\n     */\n    get colorinversion() {\n        return this._colorinversion;\n    }\n    set colorinversion(value) {\n        if (value === this._colorinversion) {\n            return;\n        }\n        this._colorinversion = value;\n        this._updateStyle();\n    }\n    /**\n     * Dispose of resources held by the image viewer.\n     */\n    dispose() {\n        if (this._img.src) {\n            URL.revokeObjectURL(this._img.src || '');\n        }\n        super.dispose();\n    }\n    /**\n     * Reset rotation and flip transformations.\n     */\n    resetRotationFlip() {\n        this._matrix = [1, 0, 0, 1];\n        this._updateStyle();\n    }\n    /**\n     * Rotate the image counter-clockwise (left).\n     */\n    rotateCounterclockwise() {\n        this._matrix = Private.prod(this._matrix, Private.rotateCounterclockwiseMatrix);\n        this._updateStyle();\n    }\n    /**\n     * Rotate the image clockwise (right).\n     */\n    rotateClockwise() {\n        this._matrix = Private.prod(this._matrix, Private.rotateClockwiseMatrix);\n        this._updateStyle();\n    }\n    /**\n     * Flip the image horizontally.\n     */\n    flipHorizontal() {\n        this._matrix = Private.prod(this._matrix, Private.flipHMatrix);\n        this._updateStyle();\n    }\n    /**\n     * Flip the image vertically.\n     */\n    flipVertical() {\n        this._matrix = Private.prod(this._matrix, Private.flipVMatrix);\n        this._updateStyle();\n    }\n    /**\n     * Handle `update-request` messages for the widget.\n     */\n    onUpdateRequest(msg) {\n        if (this.isDisposed || !this.context.isReady) {\n            return;\n        }\n        this._render();\n    }\n    /**\n     * Handle `'activate-request'` messages.\n     */\n    onActivateRequest(msg) {\n        this.node.focus();\n    }\n    /**\n     * Handle a change to the title.\n     */\n    _onTitleChanged() {\n        this.title.label = PathExt.basename(this.context.localPath);\n    }\n    /**\n     * Render the widget content.\n     */\n    _render() {\n        const context = this.context;\n        const cm = context.contentsModel;\n        if (!cm) {\n            return;\n        }\n        const oldurl = this._img.src || '';\n        let content = context.model.toString();\n        if (cm.format === 'base64') {\n            this._img.src = `data:${this._mimeType};base64,${content}`;\n        }\n        else {\n            const a = new Blob([content], { type: this._mimeType });\n            this._img.src = URL.createObjectURL(a);\n        }\n        URL.revokeObjectURL(oldurl);\n    }\n    /**\n     * Update the image CSS style, including the transform and filter.\n     */\n    _updateStyle() {\n        const [a, b, c, d] = this._matrix;\n        const [tX, tY] = Private.prodVec(this._matrix, [1, 1]);\n        const transform = `matrix(${a}, ${b}, ${c}, ${d}, 0, 0) translate(${tX < 0 ? -100 : 0}%, ${tY < 0 ? -100 : 0}%) `;\n        this._img.style.transform = `scale(${this._scale}) ${transform}`;\n        this._img.style.filter = `invert(${this._colorinversion})`;\n    }\n}\n/**\n * A widget factory for images.\n */\nexport class ImageViewerFactory extends ABCWidgetFactory {\n    /**\n     * Create a new widget given a context.\n     */\n    createNewWidget(context) {\n        const content = new ImageViewer(context);\n        const widget = new DocumentWidget({ content, context });\n        return widget;\n    }\n}\n/**\n * A namespace for image widget private data.\n */\nvar Private;\n(function (Private) {\n    /**\n     * Multiply 2x2 matrices.\n     */\n    function prod([a11, a12, a21, a22], [b11, b12, b21, b22]) {\n        return [\n            a11 * b11 + a12 * b21,\n            a11 * b12 + a12 * b22,\n            a21 * b11 + a22 * b21,\n            a21 * b12 + a22 * b22\n        ];\n    }\n    Private.prod = prod;\n    /**\n     * Multiply a 2x2 matrix and a 2x1 vector.\n     */\n    function prodVec([a11, a12, a21, a22], [b1, b2]) {\n        return [a11 * b1 + a12 * b2, a21 * b1 + a22 * b2];\n    }\n    Private.prodVec = prodVec;\n    /**\n     * Clockwise rotation transformation matrix.\n     */\n    Private.rotateClockwiseMatrix = [0, 1, -1, 0];\n    /**\n     * Counter-clockwise rotation transformation matrix.\n     */\n    Private.rotateCounterclockwiseMatrix = [0, -1, 1, 0];\n    /**\n     * Horizontal flip transformation matrix.\n     */\n    Private.flipHMatrix = [-1, 0, 0, 1];\n    /**\n     * Vertical flip transformation matrix.\n     */\n    Private.flipVMatrix = [1, 0, 0, -1];\n})(Private || (Private = {}));\n//# sourceMappingURL=widget.js.map"],"sourceRoot":""}